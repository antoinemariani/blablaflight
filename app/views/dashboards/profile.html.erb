<div class="container pt-4">
  <h1>Hello, <%= current_user.first_name %> <%= current_user.last_name %> !</h1>

  <div class="card-profile">
    <div class="img-profile">
      <% if current_user.photo.key %>
        <%= cl_image_tag current_user.photo.key %>
      <% else %>
        <%= cl_image_tag("https://images.assetsdelivery.com/compings_v2/nexusby/nexusby1810/nexusby181000286.jpg") %>
      <% end %>
    </div>
    <div class="card-profile-infos">
      <p><strong>Name : </strong></p>
      <%= current_user.first_name %> <%= current_user.last_name %>
    </div>
    <div class="card-profile-infos">
      <p><strong>Email :</strong></p>
      <%= current_user.email %>
    </div>
    <div class="card-profile-infos">
      <p><strong>Pilot :</strong></p>
      <%= current_user.pilot ? "Yes 🛩 " : "No 🐣"%>
    </div>
      <div><%= link_to "Update profile", edit_user_registration_path, class: "btn btn-info m-2 mt-3 me-5" %></div>
  </div>

  <br>
  <div>
    <% if current_user.pilot == true%>
      <%= link_to "Add a Flight", new_flight_path, class: "btn btn-flat mb-4" %>
      <% @user_flights.each do |f| %>
      <div class="card-product">
        <% if f.photo.attached? %>
          <%= cl_image_tag f.photo.key %>
        <% else %>
          <img src="https://www.openfly.fr/contentfiles/content-page-pictures/14309/GE%CC%81NE%CC%81RAL-2.webp" />
        <% end %>
        <div class="card-product-infos" style="flex-grow: 1">
          <h2><%=f.departure %> > <%=f.arrival %></h2>
              <p>Date: <%=f.date %></p>
              <p>Capacity: <%=f.capacity %> people</p>
              <p>Price/p: <%=f.price %> euros</p>
        </div>
        <div class="card-product-infos">
          <%= link_to "Edit this flight", edit_flight_path(f.id), class: "btn btn-outline-info me-3" %>
          <%= link_to "Cancel this flight", flight_path(f.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: "btn btn-outline-danger me-3" %>
        </div>
      </div>
      <div class="card-booking-flight justify-content-end ms-5">
      <% sum = 0 %>
        <% f.bookings.each do |b| %>
        <div class="card-product-infos pe-2">
          <span><%= b.reload_user.first_name %> <%= b.reload_user.last_name.upcase %></span>
          <span class="d-block"><%= b.reload_user.email %></span>
          <h2>Seat <%= sum += 1 %></h2>
        </div>
        <div class="card-product-infos ps-2">
          <%= link_to "Accept the booking", accept_flight_booking_path(f,b), data: {turbo_method: :patch, turbo_confirm: "Are you sure?"}, class: "btn btn-outline-success me-3" if b.status != "true" %>
          <%= link_to "Decline the booking", decline_flight_booking_path(f, b), data: {turbo_method: :patch, turbo_confirm: "Are you sure?"}, class: "btn btn-outline-danger me-3" %>
        </div>
        <% end %>
      </div>
      <br>
      <% end %>
    <% end %>
  </div>

  <br>
  <div>
      <%= link_to "Add a Booking", flights_path, class: "btn btn-flat mb-4" %>
      <% if @user_bookings.count > 0%>
        <%@user_bookings.each do |b| %>
        <div class="card-product">
          <% if b.flight.photo.attached? %>
            <%= cl_image_tag b.flight.photo.key %>
          <% else %>
            <img src="https://images.unsplash.com/photo-1527605158555-853f200063e9?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=671&q=80" />
          <% end %>
          <div class="card-product-infos" style="flex-grow:1">
            <h2><%=b.flight.departure %> > <%=b.flight.arrival %></h2>
              <p>Date: <%= b.flight.date %></p>
              <p>Capacity: <%= b.flight.capacity %> people</p>
              <p>Price: <%= b.flight.price %> euros</p>
              <% if b.status == "Pending" %>
                <span class="btn btn-warning mt-3">Status : <%= b.status %></span>
              <% elsif b.status == "true" %>
                <span class="btn btn-success mt-3">Status : Accepted</span>
              <%elsif b.status == "false" %>
                <span class="btn btn-danger mt-3">Status : Declined</span>
              <%end %>
          </div>
          <div class="card-product-infos">
              <%= link_to "Cancel this booking", booking_path(b.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: "btn btn-outline-danger me-3" %>
          </div>
        </div>
        <br>
        <% end %>
      <% end %>
  </div>
</div>
